#include <stdio.h>
#include <stdlib.h>

// NB: tested on debian wheezy amd64

#define BUFSIZE   104
#define RBPOFFSET   8   // YMMV
#define RIPOFFSET  16   // YMMV

void handler()
{
  char buf[BUFSIZE];

  if (getenv("DEBUG")) {
    printf("&rbp: %p\n", &buf[0] + BUFSIZE + RBPOFFSET);
    printf("&rip: %p\n", &buf[0] + BUFSIZE + RIPOFFSET);
    printf(" rbp: %p\n", *(void**)(&buf[0] + BUFSIZE + RBPOFFSET);
    printf(" rip: %p\n", *(void**)(&buf[0] + BUFSIZE + RIPOFFSET);
  }

  while (!feof(stdin)) {
    gets(buf);    // buffer overflow
    printf(buf);  // uncontrolled format string
    printf("\n");
    fflush(stdout);
  }
}

int main()
{
  handler();
  return 0;
}
